(function(a){redux.field_objects=redux.field_objects||{};redux.field_objects.repeater=redux.field_objects.repeater||{};a(document).ready(function(){});redux.field_objects.repeater.sort_repeaters=function(b){if(!b.hasClass("redux-container-repeater")){b=b.parents(".redux-container-repeater:first")}b.find(".redux-repeater-accordion-repeater").each(function(d){var j=a(this).attr("data-sortid");var f=a(this).find("input[name*='["+j+"]']");f.each(function(){a(this).attr("name",a(this).attr("name").replace("["+j+"]","["+d+"]"))});var c=a(this).find("select[name*='["+j+"]']");c.each(function(){a(this).attr("name",a(this).attr("name").replace("["+j+"]","["+d+"]"))});var e=a(this).find("textarea[name*='["+j+"]']");e.each(function(){a(this).attr("name",a(this).attr("name").replace("["+j+"]","["+d+"]"))});a(this).attr("data-sortid",d);var i=a(this).find(".ui-accordion-header");var g=i.attr("id").split("-header-");i.attr("id",g[0]+"-header-"+d);g=i.attr("aria-controls").split("-panel-");i.attr("aria-controls",g[0]+"-panel-"+d);var h=a(this).find(".ui-accordion-content");var g=h.attr("id").split("-panel-");h.attr("id",g[0]+"-panel-"+d);g=h.attr("aria-labelledby").split("-header-");h.attr("aria-labelledby",g[0]+"-header-"+d)})};redux.field_objects.repeater.init=function(b){if(!b){b=a(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible")}a(b).each(function(c){var g=a(this);var f=g;if(!g.hasClass("redux-field-container")){f=g.parents(".redux-field-container:first")}if(f.is(":hidden")){return}if(f.hasClass("redux-field-init")){f.removeClass("redux-field-init")}else{return}var f=g;if(!g.hasClass("redux-field-container")){f=g.parents(".redux-field-container:first")}var e=f.attr("data-id");var i=g.find(".redux-repeater-accordion-repeater:last-child");redux.repeater[e].blank=i.clone().wrap("<p>").parent().html();if(f.hasClass("redux-container-repeater")){f.addClass("redux-field-init")}if(f.hasClass("redux-field-init")){f.removeClass("redux-field-init")}else{return}var h=false;var d=g.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:true,activate:function(j,k){a.redux.initFields()},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}});if(redux.repeater[e].sortable==1){d.sortable({axis:"y",handle:"h3",connectWith:".redux-repeater-accordion",placeholder:"ui-state-highlight",start:function(k,j){j.placeholder.height(j.item.height());j.placeholder.width(j.item.width())},stop:function(j,k){k.item.children("h3").triggerHandler("focusout");redux.field_objects.repeater.sort_repeaters(a(this))}})}else{d.find("h3.ui-accordion-header").css("cursor","pointer")}g.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(j){if(a(j.target).find(":selected").text().length>0){var k=a(j.target).find(":selected").text()}else{var k=a(j.target).val()}a(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(k)});g.find(".redux-repeaters-remove").live("click",function(){redux_change(a(this));var k=a(this).parents(".redux-container-repeater:first");var j=k.attr("data-id");redux.repeater[j].blank=a(this).parents(".redux-repeater-accordion-repeater:first").clone(true,true);a(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){a(this).remove();redux.field_objects.repeater.sort_repeaters(g);if(redux.repeater[j].limit!=""){var l=k.find(".redux-repeater-accordion-repeater").length;if(l<redux.repeater[j].limit){k.find(".redux-repeaters-add").removeClass("button-disabled")}}k.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click()})});String.prototype.reduxReplaceAll=function(k,j){return this.replace(new RegExp(k.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),j)};g.find(".redux-repeaters-add").click(function(){if(a(this).hasClass("button-disabled")){return}var m=a(this).parent().find(".redux-repeater-accordion:first");var n=m.find(".redux-repeater-accordion-repeater").length;var l=m.attr("data-id");if(redux.repeater[l].limit!=""){if(n>=redux.repeater[l].limit){a(this).addClass("button-disabled");return}}n++;var o=m.find(".redux-repeater-accordion-repeater").size();if(m.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")){m.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").click()}var j=m.find(".redux-repeater-accordion-repeater:last").clone(true,true);if(j.length==0){j=redux.repeater[l].blank}if(redux.repeater[l]){redux.repeater[l].count=g.find(".redux-repeater-header").length;var k=redux.repeater[l].html.reduxReplaceAll("99999",o);a(j).find(".redux-repeater-header").text("")}j.find(".ui-accordion-content").html(k);a(m).append(j);redux.field_objects.repeater.sort_repeaters(j);var j=a(this).parent().find(".redux-repeater-accordion:first");j.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click();j.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(p){if(a(p.target).find(":selected").text().length>0){var q=a(p.target).find(":selected").text()}else{var q=a(p.target).val()}a(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(q)});if(redux.repeater[l].limit>0&&n>=redux.repeater[l].limit){a(this).addClass("button-disabled")}})})}})(jQuery);