!function(t,e,n){"use strict";if(void 0===t)throw"Missing dependency: jQuery\nhttps://code.jquery.com/";var r=function(){if(!(this instanceof r))throw"MMDND: MMDND is a constructor";this._init()};t.extend(r.prototype,{_init:function(){if(t(n).data("mmdnd"))throw"MMDND: already initialized";t(n).data("mmdnd",this),this._window=e,this._document=n,this._bindInit()},destroy:function(){this._clear(),t(n).removeData("mmdnd")},_clear:function(){t(this._dropElement).removeAttr("data-jquery-mmdnd-dragover"),t(this._dragElement).off(".mmdnd").removeAttr("data-jquery-mmdnd-dragging"),t(this._ghostElement).remove(),t(this._document).off(".mmdnd"),t(this._document.documentElement).removeAttr("data-jquery-mmdnd-dragging"),clearInterval(this._autoScrollInterval),this._top=null,this._origin=null,this._children=null,this._frameOffsetX=null,this._frameOffsetY=null,this._windowWidth=null,this._windowHeight=null,this._dragElement=null,this._dropElement=null,this._dropTarget=null,this._ghostElement=null,this._ghostOffsetX=null,this._ghostOffsetY=null,this._mouseStart=null,this._mouseMove=null,this._autoScrollInterval=null,this._data=null},_bindInit:function(){this._clear(),t(this._document).on("mousedown.mmdnd","[data-jquery-mmdnd-draggable]",this._handleMouseDownPredrag.bind(this))},_bindDrag:function(){t(this._document).off(".mmdnd"),t(this._document.documentElement).attr("data-jquery-mmdnd-dragging",""),this._calcFrameOffsets();var e="[data-jquery-mmdnd-droppable]";this._origin._dropTarget&&(e='[data-jquery-mmdnd-droppable="'+this._origin._dropTarget+'"]'),this===this._origin&&t(this._dragElement).one("mousemove.mmdnd mouseleave.mmdnd",this._handleMouseMoveDragStart.bind(this)),t(this._document).on("contextmenu.mmdnd",this._handlePreventUserInteraction.bind(this)).on("keydown.mmdnd",this._handleKeyPressUserInteraction.bind(this)).on("wheel.mmdnd",this._handleWheel.bind(this)).on("mousemove.mmdnd",this._handleMouseMoveDrag.bind(this)).on("mouseenter.mmdnd",e,this._handleMouseEnterDragEnter.bind(this)).on("mousemove.mmdnd",e,this._handleMouseMoveDragOver.bind(this)).on("mouseleave.mmdnd",e,this._handleMouseLeaveDragLeave.bind(this)).on("mouseup.mmdnd",e,this._handleMouseUpDrop.bind(this)).on("mousedown.mmdnd mouseup.mmdnd",this._handleMouseUpDragEnd.bind(this))},_bindInitAll:function(){var e=t.merge(t.merge([],[this._top]),this._top._children);t.each(e,function(t,e){e._bindInit()}.bind(this))},_bindDragAll:function(){var e=t.merge(t.merge([],[this._top]),this._top._children);t.each(e,function(t,e){e._top=this._top,e._origin=this,e._children=e._childFrames(),e._windowWidth=e._window.jQuery(e._window).width(),e._windowHeight=e._window.jQuery(e._window).height(),e._documentScrollWidth=e._document.documentElement.scrollWidth||e._document.body.scrollWidth||0,e._documentScrollHeight=e._document.documentElement.scrollHeight||e._document.body.scrollHeight||0,e._bindDrag()}.bind(this))},_topFrame:function(){for(var t=e;t!==t.parent;){try{if(!t.parent.jQuery(t.parent.document).data("mmdnd"))throw""}catch(t){break}t=t.parent}return t.jQuery(t.document).data("mmdnd")},_childFrames:function(){for(var t=[],e=0;e<this._window.frames.length;e++){var n;try{if(!(n=this._window.frames[e].window.jQuery(this._window.frames[e].window.document).data("mmdnd")))throw""}catch(t){continue}t.push(n),t.push.apply(t,n._childFrames())}return t},_calcFrameOffsets:function(){if(this._frameOffsetX=0,this._frameOffsetY=0,this._window.frameElement)try{var t=this._window.frameElement,e=t.getBoundingClientRect(),n=t.ownerDocument,r=n.defaultView.jQuery(n).data("mmdnd");this._frameOffsetX=r._frameOffsetX+Math.round(e.x),this._frameOffsetY=r._frameOffsetY+Math.round(e.y)}catch(t){}},_createGhost:function(e){if(!e){for(var n=this._window.getComputedStyle(this._dragElement,null),r={},o=0;o<n.length;o++){var a=n[o],i=n.getPropertyValue(a);r[a]=i}e=t(this._dragElement).clone().removeAttr("id").removeAttr("data-jquery-mmdnd-draggable").css(r).get(0)}return t("<div />").attr("data-jquery-mmdnd-ghost","").append(e).get(0)},_repositionGhost:function(){this._origin._mouseMove&&(t(this._origin._ghostElement).css({top:this._origin._mouseMove.clientY+this._frameOffsetY-this._origin._ghostOffsetY+"px",left:this._origin._mouseMove.clientX+this._frameOffsetX-this._origin._ghostOffsetX+"px"}),this._origin._ghostElement.parentElement||t(this._origin._ghostElement).appendTo(this._top._document.body))},_mouseEventProperties:function(e,n){var r={clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY};if(n&&e.currentTarget!==e.target)try{var o=t(e.currentTarget).offset(),a=t(e.target).offset();r.offsetX+=a.left-o.left,r.offsetY+=a.top-o.top}catch(e){}return r},_triggerEvent:function(e,n,r,o){var a={getData:this._eventGetData.bind(this),setData:this._eventSetData.bind(this),setGhostElement:this._eventSetGhostElement.bind(this)};r&&t.extend(a,{altKey:r.altKey,button:r.button,buttons:r.buttons,char:r.char,charCode:r.charCode,ctrlKey:r.ctrlKey,key:r.key,keyCode:r.keyCode,metaKey:r.metaKey,originalEvent:r.originalEvent,shiftKey:r.shiftKey,view:r.view,which:r.which}),o&&t.extend(a,o);var i=t.Event("mmdnd"+n,a);return t(e).trigger(i),i},_getDocumentScroll:function(){return{x:this._document.documentElement.scrollLeft||this._document.body.scrollLeft||0,y:this._document.documentElement.scrollTop||this._document.body.scrollTop||0}},_setDocumentScroll:function(t,e){var n,r;t||0==t||(t=(n=n||this._getDocumentScroll()).x),e||0==e||(e=(n=n||this._getDocumentScroll()).y),(r=t.toString().match(/^(\+|-)=(\d+)$/))&&(t=(n=n||this._getDocumentScroll()).x+1*(r[1]+r[2])),(r=e.toString().match(/^(\+|-)=(\d+)$/))&&(e=(n=n||this._getDocumentScroll()).y+1*(r[1]+r[2])),this._document.documentElement.scrollLeft=t,this._document.body.scrollLeft=t,this._document.documentElement.scrollTop=e,this._document.body.scrollTop=e},_eventGetData:function(t){return this._origin._data[t]},_eventSetData:function(t,e){this._origin._data[t]=e},_eventSetGhostElement:function(e,n,r){t(this._ghostElement).parent().length||t(this._ghostElement).css("visibility","hidden").appendTo(this._document.body);var o=t(this._ghostElement).width(),a=t(this._ghostElement).height();t(this._ghostElement).remove(),this._ghostElement=this._createGhost(t(e).get(0)),t(this._ghostElement).css("visibility","hidden").appendTo(this._document.body);var i=t(this._ghostElement).width(),s=t(this._ghostElement).height();t(this._ghostElement).detach().css("visibility",""),isNaN(1*n)&&(this._ghostOffsetX=this._ghostOffsetX/o*i),isNaN(1*r)&&(this._ghostOffsetY=this._ghostOffsetY/a*s),this._repositionGhost()},_autoScrollCalc:function(){var t=this._getDocumentScroll(),e={x:null,y:null};return this._origin._mouseMove.clientX<16&&this._origin._mouseMove.clientX>0&&t.x>0?e.x="-="+(16-Math.max(this._origin._mouseMove.clientX,0)):this._windowWidth-this._origin._mouseMove.clientX<16&&this._origin._mouseMove.clientX<this._windowWidth&&t.x<this._documentScrollWidth-this._windowWidth&&(e.x="+="+(16-Math.max(this._windowWidth-this._origin._mouseMove.clientX,0))),this._origin._mouseMove.clientY<16&&this._origin._mouseMove.clientY>0&&t.y>0?e.y="-="+(16-Math.max(this._origin._mouseMove.clientY,0)):this._windowHeight-this._origin._mouseMove.clientY<16&&this._origin._mouseMove.clientY<this._windowHeight&&t.y<this._documentScrollHeight-this._windowHeight&&(e.y="+="+(16-Math.max(this._windowHeight-this._origin._mouseMove.clientY,0))),{scroll:t,step:e}},_autoScrollInit:function(){var e=t.merge(t.merge([],[this]),this._children);return clearInterval(this._autoScrollInterval),this._autoScrollInterval=setInterval(function(){var n=this._autoScrollCalc();this._setDocumentScroll(n.step.x,n.step.y),t.each(e,function(t,e){e._calcFrameOffsets()}.bind(this)),n.step.x||n.step.y||this._autoScrollClear()}.bind(this),20),this._autoScrollInterval},_autoScrollClear:function(){clearInterval(this._autoScrollInterval),this._autoScrollInterval=null},_autoScrollUpdate:function(){var t=this._autoScrollCalc();this._autoScrollInterval||!t.step.x&&!t.step.y?!this._autoScrollInterval||t.step.x||t.step.y||this._autoScrollClear():this._autoScrollInit()},_handlePreventUserInteraction:function(t){t.preventDefault()},_handleKeyPressUserInteraction:function(t){27==t.which&&this._handleMouseUpDragEnd(t),this._handlePreventUserInteraction(t)},_handleWheel:function(t){this._autoScrollClear()},_handleMouseDownPredrag:function(e){if(1==e.which){var n=this._window.getComputedStyle(e.currentTarget,null),r=e.currentTarget.getBoundingClientRect();this._top=null,this._origin=this,this._children=null,this._frameOffsetX=null,this._frameOffsetY=null,this._windowWidth=null,this._windowHeight=null,this._documentScrollWidth=null,this._documentScrollHeight=null,this._dragElement=e.currentTarget,this._dropTarget=t(e.currentTarget).attr("data-jquery-mmdnd-draggable"),this._dropElement=null,this._ghostElement=this._createGhost(),this._ghostOffsetX=e.clientX-Math.round(r.x)+parseFloat(n.getPropertyValue("margin-left")),this._ghostOffsetY=e.clientY-Math.round(r.y)+parseFloat(n.getPropertyValue("margin-top")),this._mouseStart=this._mouseEventProperties(e),this._mouseMove=null,this._data={},this._top=this._topFrame(),this._top._children=this._top._childFrames(),t(this._dragElement).attr("data-jquery-mmdnd-dragging",""),this._bindDragAll(),this._origin._triggerEvent(this._origin._dragElement,"predrag",e,this._mouseStart),e.preventDefault()}},_handleMouseMoveDragStart:function(e){t(this._dragElement).off(".mmdnd"),this._triggerEvent(this._dragElement,"dragstart",e,this._mouseStart)},_handleMouseMoveDrag:function(t){this._origin._mouseMove=this._mouseEventProperties(t),this._autoScrollUpdate(),this._repositionGhost(),this._origin._triggerEvent(this._origin._dragElement,"drag",t,this._origin._mouseMove)},_handleMouseEnterDragEnter:function(e){t(this._origin._dropElement).removeAttr("data-jquery-mmdnd-dragover"),this._origin._dropElement=null,this._triggerEvent(e.currentTarget,"dragenter",e,this._mouseEventProperties(e,!0))},_handleMouseMoveDragOver:function(e){var n=t(e.target).closest('[data-jquery-mmdnd-droppable="'+this._origin._dropTarget+'"]').get(0)!==e.currentTarget,r=null!==this._origin._dropElement;if(!n||!r){if(this._triggerEvent(e.currentTarget,"dragover",e,this._mouseEventProperties(e,!0)).isDefaultPrevented())return t(this._origin._dropElement).removeAttr("data-jquery-mmdnd-dragover"),void(this._origin._dropElement=null);t(this._origin._dropElement).removeAttr("data-jquery-mmdnd-dragover"),this._origin._dropElement=e.currentTarget,t(this._origin._dropElement).attr("data-jquery-mmdnd-dragover","")}},_handleMouseLeaveDragLeave:function(e){t(this._origin._dropElement).removeAttr("data-jquery-mmdnd-dragover"),this._origin._dropElement=null,this._triggerEvent(e.currentTarget,"dragleave",e,this._mouseEventProperties(e,!0))},_handleMouseUpDrop:function(t){1==t.which&&this._origin&&this._origin._dropElement&&this._origin._dropElement===t.currentTarget&&this._triggerEvent(this._origin._dropElement,"drop",t,this._mouseEventProperties(t,!0))},_handleMouseUpDragEnd:function(t){if(null!==this._origin._dropElement){var e=this._origin._dropElement,n=e.ownerDocument;n.defaultView.jQuery(n).data("mmdnd")._triggerEvent(e,"dragleave")}null!==this._origin._mouseMove&&this._origin._triggerEvent(this._origin._dragElement,"dragend",t,this._origin._mouseMove),this._bindInitAll()}}),t(function(){new r})}(window.jQuery,window,document),function($,window,document){"use strict";var that={status:{ready:!1,load:!1},version:"3.0",prefix:"op3",layer:"none",data:function(t,e){return $(document).data(t,e)},removeData:function(t){$(document).removeData(t)},bind:function(t,e){$(document).on(_jqkeyfix(t),e)},once:function(t,e){$(document).one(_jqkeyfix(t),e)},unbind:function(t,e){$(document).off(_jqkeyfix(t),e)},emit:function(t,e,n){if(OP3.disableEvents)return!1;var r=_jqkeyfix(t),o=$.extend({origin:OP3},n,{type:r,target:OP3}),a=$.Event(r,o);return $(document).trigger(a,e),a.isDefaultPrevented()},dispatch:function(t,e,n){if(OP3.disableEvents)return!1;var r=window,o=$.extend({origin:window.OP3},n),a=!1;for(a=a||r.OP3.emit(t,e,o);!a&&r!==r.parent&&_same_origins(r,r.parent)&&r.parent.OP3&&"function"==typeof r.parent.OP3.emit;)r=r.parent,a=a||r.OP3.emit(t,e,o);return a},broadcast:function(t,e,n){if(OP3.disableEvents)return!1;for(var r=window,o=$.extend({origin:window.OP3},n),a=!1,i=0;i<r.frames.length;i++)!a&&_same_origins(r,r.frames[i])&&r.frames[i].OP3&&"function"==typeof r.frames[i].OP3.emit&&(a=(a=a||r.frames[i].OP3.emit(t,e,o))||r.frames[i].OP3.broadcast(t,e,o));return a},transmit:function(t,e,n){return!OP3.disableEvents&&(that.dispatch(t,e,n)||that.broadcast(t,e,n))},defineClass:function(options){options=options||{};var _name=options.Name,_constructor=options.Constructor,_extends=options.Extends,_prototype=options.Prototype;if(void 0!==_name&&"string"!=typeof _name)throw new TypeError("Class argument options.Name must be of type string");if(void 0!==_constructor&&"function"!=typeof _constructor)throw new TypeError("Class argument options.Constructor must be of type function");if(void 0!==_extends&&"function"!=typeof _extends)throw new TypeError("Class argument options.Extends must be of type function");if(void 0!==_prototype&&"object"!=typeof _prototype)throw new TypeError("Class argument options.Prototype must be of type function");if(_name){if(_name=(_name||"").replace(/\W+/g,"_"),-1!==["_name","_constructor","_extends","_prototype"].indexOf(_name))throw new TypeError("Class argument options.Name can not be '"+_name+"' (reserved identifier)");if(/^[0-9]/.test(_name))throw new TypeError("Class argument options.Name can not start with number")}var OP3_Class,OP3_Wrapper=function(){if(!(this instanceof OP3_Class))throw new TypeError("Class constructor "+_name+" cannot be invoked without 'new'");"function"==typeof _constructor&&_constructor.apply(this,arguments)};try{if(!_name)throw"";var meta=OP3.Meta;if(meta&&meta.pageId||(meta=window.parent.OP3.Meta),!meta||"dev"!==meta.buildEnv)throw"";var code="var "+_name+" = "+OP3_Wrapper.toString()+";OP3_Class = "+_name+";";eval(code)}catch(t){OP3_Class=function(){OP3_Wrapper.apply(this,arguments)}}if(_extends&&(OP3_Class.prototype=Object.create(_extends.prototype)),_prototype)for(var prop in _prototype){var desc=Object.getOwnPropertyDescriptor(_prototype,prop);Object.defineProperty(OP3_Class.prototype,prop,desc)}return OP3_Class.prototype.constructor=OP3_Class,OP3_Class}},_jqkeyfix=function(t){return t=(t||"").replace(/\s+/g," ").replace(/^\s+|\s+$/g,""),OP3.prefix+t.split(" ").join(" "+OP3.prefix)},_same_origins=function(t,e){try{for(var n=1;n<arguments.length;n++)if(arguments[0].location.origin!==arguments[n].location.origin)throw""}catch(t){return!1}return!0};$.each(["version","prefix"],function(){try{Object.defineProperty(that,this,{value:that[this],writable:!1,enumerable:!0,configurable:!1})}catch(t){return!1}}),window.OP3=that,$(document).ready(function(){OP3.status.ready=!0}),$(window).on("load",function(){OP3.status.load=!0})}(jQuery,window,document),function(t,e,n){"use strict";var r={author:null,keywords:null,description:null,name:null,nonce:null,countryCode:null,pageId:null,pageTemplate:null,pageTitle:null,pagePreviewUrl:null,pageStatus:null,userRole:null,api:null,assets:null,editUrl:null,buildEnv:null,buildHash:null,_init:function(){var o=t('head meta[name="author"]'),a=t('head meta[name="description"]'),i=t('head meta[name="keywords"]'),s=t('head meta[name="application-name"]');0===s.length&&(s=t(".op-editor-mode-button-wrap"));var d={value:null,writable:!1,enumerable:!0,configurable:!1};Object.defineProperty(r,"author",t.extend({},d,{value:o.attr("content")})),Object.defineProperty(r,"description",t.extend({},d,{value:a.attr("content")})),Object.defineProperty(r,"keywords",t.extend({},d,{value:i.attr("content")})),Object.defineProperty(r,"name",t.extend({},d,{value:s.attr("content")})),Object.defineProperty(r,"nonce",t.extend({},d,{value:s.attr("data-op3-nonce")},{writable:!0})),Object.defineProperty(r,"countryCode",t.extend({},d,{value:s.attr("data-country-code")})),Object.defineProperty(r,"pageId",t.extend({},d,{value:s.attr("data-op3-page-id")})),Object.defineProperty(r,"pageTemplate",t.extend({},d,{value:s.attr("data-op3-page-template")})),Object.defineProperty(r,"pageTitle",t.extend({},d,{value:s.attr("data-op3-page-title")})),Object.defineProperty(r,"pageUrl",t.extend({},d,{value:s.attr("data-op3-page-url")})),Object.defineProperty(r,"pagePreviewUrl",t.extend({},d,{value:s.attr("data-op3-page-preview-url")})),Object.defineProperty(r,"pageStatus",t.extend({},d,{value:s.attr("data-op3-page-status")})),Object.defineProperty(r,"userRole",t.extend({},d,{value:s.attr("data-op3-user-role")})),Object.defineProperty(r,"api",t.extend({},d,{value:s.attr("data-op3-api-base-url")})),Object.defineProperty(r,"resources",t.extend({},d,{value:s.attr("data-op3-resources-base-url")})),Object.defineProperty(r,"assets",t.extend({},d,{value:s.attr("data-op3-assets-base-url")})),Object.defineProperty(r,"adminUrl",t.extend({},d,{value:s.attr("data-admin-url")})),Object.defineProperty(r,"siteUrl",t.extend({},d,{value:s.attr("data-site-url")})),Object.defineProperty(r,"editUrl",t.extend({},d,{value:s.attr("data-op3-edit-url")})),Object.defineProperty(r,"buildEnv",t.extend({},d,{value:s.attr("data-op3-build-env")})),Object.defineProperty(r,"buildHash",t.extend({},d,{value:s.attr("data-op3-build-hash")})),Object.defineProperty(r,"legacyMembership",t.extend({},d,{value:s.attr("data-op3-membership-legacy")})),Object.defineProperty(r,"facebookAppId",t.extend({},d,{value:s.attr("data-op3-facebook-app-id")})),Object.defineProperty(r,"facebookLang",t.extend({},d,{value:s.attr("data-op3-facebook-lang")})),Object.defineProperty(r,"funnelsActive",t.extend({},d,{value:parseInt(s.attr("data-op3-funnels-active"))})),t(n).on("heartbeat-tick.wp-refresh-nonces",function(t,n){n.nonces_expired&&n.rest_nonce&&(e.OP3.Meta.nonce=n.rest_nonce,e.OP3WP.nonce=n.rest_nonce)})}};e.OP3.Meta=r,e.OP3.Meta._init(),OP3.bind("domcontentloaded::liveeditor",function(t,n){OP3.layer===t.origin.layer&&e.OP3.Meta._init()}),OP3.bind("domcontentloaded::liveeditor",function(t,n){"wrapper"===OP3.layer&&(e.OP3.Meta=t.origin.Meta)}),OP3.bind("domcontentloaded::designer",function(t,n){OP3.layer===t.origin.layer&&(e.OP3.Meta=e.parent.OP3.Meta)})}(jQuery,window,document),function(t,e,n){"use strict";var r={_options:{method:"GET",dataType:"json",contentType:"application/json"},_parent:function(){var t=e;try{for(;t!==t.parent;)t=t.parent}catch(t){}return t},_beforeSend:function(t){var n=(e.OP3&&OP3.Meta?OP3.Meta.nonce:"")||(r._parent().OP3WP?r._parent().OP3WP.nonce:"")||"";n&&t.setRequestHeader("X-WP-Nonce",n)},request:function(n){var o=t.extend({},r._options,n),a=(e.OP3&&OP3.Meta?OP3.Meta.api:"")||(r._parent().OP3WP?r._parent().OP3WP.apiBaseUrl:"")||"";if(a&&o.url&&o.url.match(/^[^\/]/)&&!o.url.match(/:\/\//)&&(o.url=a+"/"+o.url),!o.url)throw"OP3.Ajax: request url not defined";if("json"===o.dataType&&"function"==typeof o.success){var i=o.success;o.success=function(){var t=Array.prototype.slice.call(arguments);if("string"==typeof t[0])try{t[0]=JSON.parse(t[0])}catch(t){}return i.apply(this,t)}}var s=o.xhr||new e.XMLHttpRequest;o.xhr=function(){return"function"==typeof o.progress&&s.addEventListener("progress",function(t){t.progress={},t.progress.loaded=t.loaded||0,t.progress.total=t.total||1*t.target.getResponseHeader("X-OP3-Content-Length")||0,t.progress.status=t.progress.total?t.progress.loaded/t.progress.total:0,t.progress.status=Math.min(1,t.progress.status),o.progress.apply(this,arguments)}),"function"==typeof o.uploadProgress&&s.upload.addEventListener("progress",function(t){t.progress={},t.progress.loaded=t.loaded||0,t.progress.total=t.total||0,t.progress.status=t.progress.total?t.progress.loaded/t.progress.total:0,o.uploadProgress.apply(this,arguments)}),s};var d=o.beforeSend;o.beforeSend=function(t){r._beforeSend(t),"function"==typeof d&&d.apply(this,arguments)},t.ajax(o)}};e.OP3.Ajax=r;var o=function(t){OP3.Loadinfo.status(t.progress.status)},a=function(t,e,n){var r={};for(var o in t.data)r[o]=t.data[o];OP3.transmit("loadajaxinit",r)};OP3.bind("load::designer",function(t){"designer"===t.target.layer&&(OP3.Loadinfo.message("Loading initial API data"),OP3.Loadinfo.start(.01),OP3.Loadinfo.status(0),OP3.Loadinfo.stop(.1),r.request({url:"pages/"+OP3.Meta.pageId+"/data",progress:o,success:a}))})}(jQuery,window,document),function(t,e,n){"use strict";var r={$frame:{},_init:function(){},setURL:function(t){r.$frame.attr("src",t)},reload:function(){var t=r.$frame.attr("data-src");r.$frame.attr("src","about:blank"),r.$frame.attr("src",t)},build:function(e){return r.$frame=t("<iframe />").attr("id","op3-frame-live-editor").attr("data-src",e).attr("src","about:blank").appendTo("body"),r.$frame}};e.OP3.Wrapper=e.OP3.Wrapper||{},e.OP3.Wrapper.Iframe=r,t(function(){OP3.Wrapper.Iframe._init()})}(jQuery,window,document),function(t,e,n){"use strict";var r={$editor:{},$toolbar:{},$button:{},$buttonWrapper:{},_init:function(){r._build()},isEnabled:function(){return r.$editor&&r.$editor.length&&r.$editor.hasClass("block-editor__container")},isActive:function(){return r.$editor&&r.$editor.length&&r.$editor.hasClass("block-editor__container")},_build:function(){r.$editor=OP3.Wrapper.Editor.$ui.wpEditor,OP3.Wrapper.Editor.$ui.dataContainer.length&&r.isEnabled()&&r.isActive()&&r.injectOPButtonToGutenbergToolbar()},open:function(){return!!OP3.Wrapper.Editor.open()},injectOPButtonToGutenbergToolbar:function(){var e=OP3.Wrapper.Editor.$ui,n=e.dataContainer.data("op3-button-label");r.$toolbar=r.$editor.find(".edit-post-header-toolbar");var o=t("<img />").attr("src",e.dataContainer.data("op3-icon-url"));r.$button=t("<a />").attr("class","button button-primary button-large components-button is-button is-large").attr("type","button").text(n),r.$button.prepend(o),r.$button.click(function(){return r.open()}),r.$buttonWrapper=t("<div />").attr("class","op-editor-gutenberg-wrapper"),r.$buttonWrapper.append(r.$button),r.$toolbar.append(r.$buttonWrapper)},autoSaveDraft:function(){var e=t("#post_ID").val();wp.data.select("core/editor").getEditedPostAttribute("title")||wp.data.dispatch("core/editor").editPost({title:"OptimizePress #"+e}),wp.data.dispatch("core/editor").savePost(),OP3.Wrapper.Editor.toggleOPMode(e,!0),r.redirectAfterSave()},redirectAfterSave:function(){setTimeout(function(){wp.data.select("core/editor").isSavingPost()?r.redirectAfterSave():(e.location=OP3.Wrapper.Editor.$ui.dataContainer.data("op3-edit-url"),e.location.reload(!0))},300)},collectPageData:function(){var e=t(".editor-post-title__input"),n=t(".editor-page-attributes__template select");return{title:e.val(),template:n.val()}}};e.OP3.Wrapper=e.OP3.Wrapper||{},e.OP3.Wrapper.Gutenberg=r,t(function(){setTimeout(function(){OP3.Wrapper.Gutenberg._init()},1)})}(jQuery,window,document),function(t,e){"use strict";var n={$ui:{},hash:"op-builder",redirecting:!1,_init:function(){n._build(),n._bindEvents(),n.autoOpen()},open:function(r){var o=!1;if(r||(o=!0,r=n.$ui.dataContainer.data("op3PageId")),r){var a=this.getEditorUrl(r),i=n.$ui.dataContainer.data("op3-page-status");if(!a)return alert("Editor URL not found!"),!1;n.toggleButton(!1),OP3.Wrapper.Gutenberg.isActive()?OP3.Wrapper.Gutenberg.autoSaveDraft():n.autoSaveDraft(),"auto-draft"!==i?(n.toggleOPMode(r,!0),OP3.Wrapper.Iframe.setURL(a),o&&(e.location.hash="#"+n.hash),n.$ui.body.addClass("wp-plugin-op3-show")):t("#op3-wrapper").fadeTo(100,.5)}},close:function(){n.$ui.frame.one("transitionend.op3-transition",function(){n.$ui.frame.attr("src","about:blank")}),n.$ui.body.removeClass("wp-plugin-op3-show");var t=n.$ui.frame.contents().find("body");t&&t.attr("data-op3-page-status")||(e.location.hash=""),parseFloat(n.$ui.frame.css("transition-duration"))||n.$ui.frame.attr("src","about:blank")},autoOpen:function(){if(e.location.hash==="#"+n.hash){var t=n.$ui.dataContainer.attr("data-op3-page-status"),r=parseInt(n.$ui.dataContainer.attr("data-op3-page-has-data")),o=n.$ui.dataContainer.data("op3PageId"),a=n.$ui.frame.attr("data-src");"auto-draft"!==t?o&&a?n.open(o):alert("Missing page ID or editor URL."):(e.location.hash="#"+n.hash,r&&n.$ui.body.addClass("wp-plugin-op3-show"),n.toggleOPMode(o,!0,!r))}},autoSaveDraft:function(){var r=this.apiBaseUrl(),o=t("#title"),a=n.$ui.dataContainer.data("op3-page-status"),i=1*n.$ui.dataContainer.data("op3-page-id");o.val()||(t("#title-prompt-text").hide(),o.val("OptimizePress #"+i)),wp.autosave&&wp.autosave.server.triggerSave(),t(document).on("heartbeat-tick.autosave",function(){if(t(e).off("beforeunload.edit-post"),"auto-draft"===a&&!n.redirecting){n.redirecting=!0;var o=n.collectPageData();OP3.Ajax.request({method:"post",data:JSON.stringify(o),url:r+"/pages/"+i+"/template",success:function(t){e.location=n.$ui.dataContainer.attr("data-op3-edit-url")},error:function(t,e,r){console.error(e),n.toggleButton(!0)}})}})},collectPageData:function(){var e=t("#title"),n=t("#page_template");return{title:e.val(),template:n.val()}},toggleButton:function(e){e?t(".op-editor-gutenberg-wrapper a.button-primary").removeAttr("disabled","disabled").fadeTo(10,1):t(".op-editor-gutenberg-wrapper a.button-primary").attr("disabled","disabled").fadeTo(10,.5)},getEditorUrl:function(n){var r=null;return(r=e.OP3WP&&e.OP3WP.liveEditorUrl?e.OP3WP.liveEditorUrl:t("meta[name=opb-live-editor-url]").attr("content"))&&(r=r.replace("%objectId%",n)),r},toggleOPMode:function(r,o,a){r||(r=n.$ui.dataContainer.data("op3PageId"));var i=this.apiBaseUrl()+"/pages/"+r+"/mode";o?t("body").addClass("op-editor-active").removeClass("op-editor-inactive"):t("body").removeClass("op-editor-active").addClass("op-editor-inactive"),OP3.Ajax.request({method:"post",url:i+(o?"/op":"/wp"),success:function(){a&&(t("#postdivrich").hide(),e.location.reload())},error:function(t,e){console.error(e)}})},backToWPEditor:function(t){return t||(t=n.$ui.dataContainer.data("op3PageId")),e.location.hash="",n.toggleOPMode(t,!1,!0),!1},apiBaseUrl:function(){var t=n.$ui.dataContainer,r=!1;return t&&t.length&&(r=t.data("op3-api-base-url")),!r&&e.OP3WP&&(r=e.OP3WP.apiBaseUrl),r},_build:function(){n.$ui.body=t("body"),n.$ui.dataContainer=t(".op-editor-data-container"),n.$ui.wpEditor=t("#editor");var e="auto-draft"!==n.$ui.dataContainer.attr("data-op3-page-status")?n.$ui.dataContainer.attr("data-op3-live-editor-url"):"";n.$ui.frame=OP3.Wrapper.Iframe.build(e)},_bindEvents:function(){t(e).on("message.op3",n._handleMessages)},_handleMessages:function(t){var e;try{e=JSON.parse(t.originalEvent.data)}catch(t){}e&&e.type===OP3.prefix&&"function"==typeof n._postMessageCallback[e.message]&&n._postMessageCallback[e.message].call(n,e)},_postMessageCallback:{loaded:function(t){},saving:function(t){},saved:function(t){},close:function(t){n.close()}}};e.OP3.Wrapper=e.OP3.Wrapper||{},e.OP3.Wrapper.Editor=n,t(function(){OP3.Wrapper.Editor._init()})}(jQuery,window,document),function(t,e,n){"use strict";e.OP3.CreateNewPage={_init:function(){}},t(function(){OP3.CreateNewPage._init()})}(jQuery,window,document),function(t,e,n){"use strict";var r={_data:{popular:[],latest:[],oldest:[]},_call:function(t){if("function"==typeof t){var e=Array.prototype.slice.call(arguments,1);t.apply(this,e)}},getFirstPage:function(t,e){return t||(t="popular"),"function"!=typeof e&&(e=function(){}),r._data||r._data[t]?0!==r._data[t].length?r._call(e,r._data[t]):void OP3.Ajax.request({url:OP3.Meta.api+"/unsplash/"+t,success:function(n,o,a){return r._data[t]=n.data,r._call(e,r._data[t])}.bind(r),error:function(t,e,n){alert("ERROR: "+e)}}):null},getNextPage:function(t,e){"function"!=typeof e&&(e=function(){}),OP3.Ajax.request({url:t,success:function(t,n,o){for(var a,i=/<(.*?)>/g,s=o.getResponseHeader("link"),d=[];a=i.exec(s);)d.push(a[1]);var l=t.results||t,u={urls:{first:d[0]||"",prev:d[1]||"",last:d[2]||"",next:d[3]||""},total:o.getResponseHeader("x-total"),perPage:o.getResponseHeader("x-per-page")};return r._call(e,l,u)}.bind(r),error:function(t,e,n){alert("ERROR: "+e)}})},search:function(t,e){t&&OP3.Ajax.request({url:OP3.Meta.api+"/unsplash/search?query="+t,success:function(t,n,o){var a=JSON.parse(t.data.response);return r._call(e,{photos:a.results,urls:t.data.urls})}.bind(r),error:function(t,e,n){alert("ERROR: "+e)}})},download:function(t,e){t&&OP3.Ajax.request({url:OP3.Meta.api+"/unsplash/download?id="+t,success:function(t,n,o){var a=JSON.parse(t.data.response);return r._call(e,{url:a.url})},error:function(t,e,n){alert("ERROR: "+e)}})}};e.OP3.Unsplash=r}(jQuery,window,document),function(t,e,n){"use strict";if(void 0!==wp.Backbone){var r=wp.Backbone.View.extend({tagName:"li",className:"photo",template:wp.template("unsplash-photo"),render:function(){return this.$el.html(this.template(this.options.photo)),this}}),o=wp.Backbone.View.extend({tagName:"div",className:"unsplash",template:wp.template("unsplash"),events:{"click #load-more":"loadMoreClickHandlerer"},loadMoreClickHandlerer:function(e){var n=t(e.target),o=n.attr("data-unsplash-next-url");n.addClass("loading"),OP3.Unsplash.getNextPage(o,function(t,e){var n=[];t.forEach(function(t,e){var o=new r({photo:t});n.push(o.render().$el)},this),this.$el.find(".frame-content button").removeClass("loading").attr("data-unsplash-next-url",e.urls.next),this.$el.find(".frame-content .photos").append(n)}.bind(this))}}),a=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments);var t=wp.media.controller.State.extend({insert:function(){this.frame.close()}});this.states.add([new t({id:"unsplash",search:!1,title:"Unsplash"})]),this.on("content:render:unsplash",this.renderUnsplashTabContent,this),this.on("open",this.frameOpen,this)},browseRouter:function(t){t.set({upload:{text:wp.media.view.l10n.uploadFilesTitle,priority:20},unsplash:{text:wp.media.view.l10n.unsplashTitle,priority:30},browse:{text:wp.media.view.l10n.mediaLibraryTitle,priority:40}})},renderUnsplashTabContent:function(){OP3.Unsplash.getFirstPage("popular",function(t){var e=new o({photos:JSON.parse(t.photos),urls:t.urls});this.content.set(e)}.bind(this))},frameOpen:function(){OP3.WpMediaFramePost._forceAttachmentsFetch()}});var i={_handleAjaxSuccess:function(t,e,n){wp.media.frame.$el.find(".unsplash .frame-content .loading").removeClass("loading");var r=wp.media.frame.content,o=t.data.media.ID;"unsplash"===r.mode()&&r.mode("browse"),i._forceAttachmentsFetch(),setTimeout(function(){var t=wp.media.frame.state().get("selection"),e=wp.media.attachment(o);t.add(e)},500)},_forceAttachmentsFetch:function(){var t=wp.media.frame.content;null!==t.get()&&t.get().collection&&t.get().options&&t.get().options.selection&&(t.get().collection._requery(!0),t.get().options.selection.reset())},handleUnsplashImageClick:function(e,n){if("A"!==e.target.nodeName){var r=t(n),o=r.attr("data-download-url");OP3.Ajax.request({url:OP3.Meta.api+"/media/import?url="+o,method:"post",data:JSON.stringify({url:o}),beforeSend:function(){this.closest(".photo-wrapper").addClass("loading")}.bind(r),success:i._handleAjaxSuccess,error:function(t,e,n){alert("ERROR: "+e)}});var a=r.attr("data-photo-id");OP3.Unsplash.download(a)}},handleOrderBySelectChange:function(e){var n=t(e).find(":selected").attr("value");OP3.Unsplash.getFirstPage(n,function(t){var e=new o({photos:JSON.parse(t.photos),urls:t.urls});wp.media.frame.content.set(e)})},handleSearch:function(e,n){if(13===e.keyCode){var r=t(n).val();OP3.Unsplash.search(r,function(t){var e=new o({query:r,photos:t.photos,urls:t.urls});wp.media.frame.content.set(e)})}}};e.OP3.WpMediaFramePost=i}}(jQuery,window,document);